<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dough Lab Admin â€¢ Stok</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .qty { min-width: 64px; display:inline-block; text-align:center; }
  </style>
</head>
<body>
  <div class="app">
    <input id="nav-toggle" type="checkbox" class="nav-toggle">
    <aside class="sidebar">
      <div class="brand">Dough Lab Admin</div>
      <nav class="nav">
        <a href="index.html">Dashboard</a>
        <a href="orders.html">Pesanan</a>
        <a href="products.html">Produk</a>
        <a href="stock.html" class="active">Stok</a>
        <a href="locations.html">Lokasi</a>
        <a href="vouchers.html">Vouchers</a>
        <a href="addon.html">Addon</a>
        <a href="pengiriman.html">Pengiriman</a>
        <a href="login.html">Keluar</a>
      </nav>
    </aside>
    <div class="content">
      <header class="topbar">
        <label for="nav-toggle" class="menu-btn">Menu</label>
        <div class="brand">Stok Produk</div>
        <div class="avatar">DL</div>
      </header>
      <main class="main compact">
        <section>
          <div class="filters">
            <input id="q" class="input" placeholder="Cari nama produk atau ID">
            <div style="display:flex;gap:8px"></div>
          </div>
        </section>
        <section>
          <table class="table">
            <thead>
              <tr>
                <th>Nama</th>
                <th>Stok</th>
                <th>Update</th>
              </tr>
            </thead>
            <tbody id="list"></tbody>
          </table>
        </section>
      </main>
    </div>
  </div>
  <script>
    function getProducts(){ try { const raw = localStorage.getItem('dl_products'); return raw?JSON.parse(raw):[]; } catch { return []; } }
    function setProducts(v){ localStorage.setItem('dl_products', JSON.stringify(v)); }
    function render(){
      const q = document.getElementById('q').value.trim().toLowerCase();
      const list = document.getElementById('list');
      list.innerHTML='';
      getProducts().filter(p=>{
        if (!q) return true;
        return (String(p.name||'').toLowerCase().includes(q) || String(p.id||'').toLowerCase().includes(q));
      }).forEach(p=>{
        const tr = document.createElement('tr');
        const stock = Number.isFinite(p.stock)?p.stock:0;
        tr.innerHTML = `
          <td>${p.name}</td>
          <td><input class="input input-stock" type="number" min="0" value="${stock}" data-id="${encodeURIComponent(p.id)}" style="width:120px"></td>
          <td>
            <div class="table-actions">
              <button class="btn" data-id="${encodeURIComponent(p.id)}" data-action="update" type="button">Update</button>
            </div>
          </td>
        `;
        list.appendChild(tr);
      })
    }
    document.getElementById('q').addEventListener('input', render);
    document.getElementById('list').addEventListener('click', (e)=>{
      const id = e.target.getAttribute('data-id');
      const action = e.target.getAttribute('data-action');
      if (!id || action!=='update') return;
      const input = document.querySelector(`.input-stock[data-id="${id}"]`);
      if (!input) return;
      const next = parseInt(input.value||'0',10);
      const products = getProducts();
      const idx = products.findIndex(p=>p.id===decodeURIComponent(id));
      if (idx<0) return;
      products[idx].stock = Number.isFinite(next) && next>=0 ? next : 0;
      setProducts(products);
      render();
    });
    document.getElementById('list').addEventListener('keydown', (e)=>{
      if (e.key==='Enter' && e.target.classList.contains('input-stock')){
        const id = e.target.getAttribute('data-id');
        const next = parseInt(e.target.value||'0',10);
        const products = getProducts();
        const idx = products.findIndex(p=>p.id===decodeURIComponent(id));
        if (idx<0) return;
        products[idx].stock = Number.isFinite(next) && next>=0 ? next : 0;
        setProducts(products);
        render();
      }
    });
    render();
  </script>
</body>
</html>
